{block content}

<h1>
  <i class="fa-solid fa-list-check fa-fw text-muted"></i>
  {_locale.test.title}:
  {$test->getCaption($locale)},
  {$test->getScheduledAt()|ldate}
</h1>

<span class="d-inline-block me-4">
  <span class="text-muted">{_locale.test.supervisors}:</span>
  {foreach $test->getSupervisors() as $supervisor}{$supervisor->getFirstName()} {$supervisor->getLastName()}{sep}, {/sep}{/foreach}
</span>
<span class="d-inline-block me-4">
  <span class="text-muted">{_locale.test.startedAt}:</span>
  {$test->getStartedAt()|ldate}
</span>
{if $test->getFinishedAt() !== null}
<span class="d-inline-block me-4">
  <span class="text-muted">{_locale.test.finishedAt}:</span>
  {$test->getFinishedAt()|ldate}
</span>
{/if}

{if $test->getStartedAt() !== null}

  <nav class="my-3">
    <ul class="pagination">
      <li class="page-item {$selectedQuestionIdx === 0 ? 'disabled'}">
        <a class="page-link"
          n:href="this question => $selectedQuestionIdx > 0 ? $questions[$selectedQuestionIdx-1]->getId()"
          >{_locale.test.previous}</a>
      </li>
      <li n:foreach="$questions as $idx => $question"
        class="page-item {$idx === $selectedQuestionIdx ? 'active'}">
        <a class="page-link {($idx !== $selectedQuestionIdx && $question->getLastAnswer() !== null) ? 'bg-success bg-opacity-25 text-success fw-bold'}"
          n:href="this question => $question->getId()">{$question->getOrdering()}</a>
      </li>
      <li class="page-item {$selectedQuestionIdx >= count($questions)-1 ? 'disabled'}">
        <a class="page-link"
          n:href="this question => $selectedQuestionIdx < count($questions)-1 ? $questions[$selectedQuestionIdx+1]->getId()"
          >{if $selectedQuestionIdx >= count($questions)}{_locale.test.end}{else}{_locale.test.next}{/if}</a>
      </li>
    </ul>
  </nav>

  <hr>

  <h3 class="mb-3">
    {block title}
      {if $selectedQuestionIdx < count($questions)}
        {_locale.test.question} #{$selectedQuestion->getOrdering()}
      {else}
        {_locale.test.completed.title}
      {/if}
    {/block}
    {if $selectedQuestionIdx < count($questions)}
      &ndash; {$selectedQuestion->getCaption($locale)}
      <span class="badge bg-secondary float-end mt-1 fs-6">{$selectedQuestion->getPoints()} {_locale.test.points}</span>
    {/if}
  </h3>

  {if $selectedQuestionIdx < count($questions)}

    <div class="bg-light border p-3 my-3 rounded">{$questionText|markdown}</div>

    {if $test->getFinishedAt() !== null}
      <div class="border rounded border-success text-success p-2 my-2"><i class="fa-regular fa-circle-check fa-fw"></i> {_locale.test.correctAnswer}</div>
      <div class="border rounded border-danger text-danger p-2 my-2"><i class="fa-regular fa-circle-xmark fa-fw"></i> {_locale.test.wrongAnswer}</div>

      {$questionResult|noescape}
    {else}
      <form action="{link Save! question: $selectedQuestion->getId()}" method="POST" data-ajax data-ajax-button="saveButton">
        {$questionForm|noescape}

        {if $answer}
        <div class="mt-4 mb-1">
          <i class="fa-solid fa-circle-info fa-fw text-muted"></i>
          {_locale.test.alreadyAnsweredInfo}
        </div>
        {/if}
        <button id="saveButton" type="submit" class="btn btn-success btn-lg shadow mt-3">
          <i class="fa-solid fa-download fa-fw"></i>
          {_locale.test.saveAndContinue}
        </button>

      </form>
    {/if}
  {else}
    <p>
      {_locale.test.completed.message1}
    </p>
    <p>
      {_locale.test.completed.message2}
    </p>

  {/if}

{else}
  <p class="my-4"><i class="fa-solid fa-triangle-exclamation fa-fw text-warning"></i> {_locale.test.hasNotStartedYet}</div>
{/if}
